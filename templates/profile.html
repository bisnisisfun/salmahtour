<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Jamaah Umroh Salmah Gresik</title>
    <link rel="stylesheet" href="/static/profile.css">
</head>
<body class="profile-body">
    <div class="profile-container">
        <header class="header">
            <h1>Jamaah Umroh Salmah Gresik</h1>
        </header>

        <div class="profile-content">
            <div class="profile-info">
                <div class="profile-photo">
                    {% if data and data['Pass Foto'] %}
                    <img src="/uploads/{{ data['Pass Foto'] }}" alt="Pass Foto" class="photo-thumbnail">
                    {% else %}
                    <img src="/static/default-profile.png" alt="Default Photo" class="photo-thumbnail">
                    {% endif %}
                </div>

                <div class="profile-details">
                    <h2>Selamat Datang, {{ name }}!</h2>
                    <p><strong>Email:</strong> {{ email }}</p>
                    <p><strong>ID Primary:</strong> {{ user_id }}</p>
                    <h3>Data Diri:</h3>
                    {% if data %}
                    <ul>
                        <li><strong>NIK:</strong> {{ data['NIK'] }}</li>
                        <li><strong>Nama:</strong> {{ data['Nama'] }}</li>
                        <li><strong>Nama Ayah:</strong> {{ data['Ayah'] }}</li>
                        <li><strong>Nomor HP:</strong> {{ data['HP'] }}</li>
                        <li><strong>Nomor HP Keluarga:</strong> {{ data['HP Keluarga'] }}</li>
                        <li><strong>Usia:</strong> {{ data['Usia'] }}</li>
                        <li><strong>Alamat:</strong> {{ data['Alamat'] }}</li>
                        <li><strong>Alergi Makanan:</strong> {{ data['Alergi'] }}</li>
                        <li><strong>Kursi Roda atau Alat Bantu Dengar:</strong> {{ data['KursiRoda'] }}</li>
                        <li><strong>Jenis Perjalanan:</strong> {{ data['JenisPerjalanan'] }}</li>
                        <li><strong>Keberangkatan:</strong> {{ data['Keberangkatan'] }}</li>
                    </ul>
                    {% else %}
                    <p>Data profil belum lengkap.</p>
                    {% endif %}
                </div>
            </div>

            <h2>Pengisian Data Umroh</h2>
            <form action="/profile" method="POST" enctype="multipart/form-data" class="form-data">
                <div class="form-group">
                    <label for="nik">NIK (Nomor Induk Kependudukan)</label>
                    <input type="number" id="nik" name="nik" required>
                </div>

                <div class="form-group">
                    <label for="nama">Nama Lengkap</label>
                    <input type="text" id="nama" name="nama" required>
                </div>

                <div class="form-group">
                    <label for="ayah">Nama Ayah Kandung</label>
                    <input type="text" id="ayah" name="ayah" required>
                </div>

                <div class="form-group">
                    <label for="hp">Nomor HP</label>
                    <input type="number" id="hp" name="hp" required>
                </div>

                <div class="form-group">
                    <label for="hp_keluarga">Nomor Telepon Keluarga (Darurat)</label>
                    <input type="number" id="hp_keluarga" name="hp_keluarga" required>
                </div>

                <div class="form-group">
                    <label for="usia">Usia</label>
                    <input type="number" id="usia" name="usia" required>
                </div>

                <div class="form-group">
                    <label for="alamat">Alamat Lengkap</label>
                    <input type="text" id="alamat" name="alamat" required>
                </div>

                <div class="form-group">
                    <label for="alergi">Alergi Makanan (sebutkan makanan apa saja)</label>
                    <input type="text" id="alergi" name="alergi">
                </div>

                <div class="form-group">
                    <label for="kursi_roda">Membutuhkan Kursi Roda atau Alat Bantu Dengar?</label>
                    <select id="kursi_roda" name="kursi_roda" required>
                        <option value="Tidak">Tidak</option>
                        <option value="Ya">Ya</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="jenis_perjalanan">Jenis Perjalanan</label>
                    <select id="jenis_perjalanan" name="jenis_perjalanan" required>
                        <option value="Umroh">Umroh</option>
                        <option value="Haji">Haji</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="keberangkatan">Tanggal Keberangkatan( klik gambar kalender sebelah kanan)</label>
                    <input type="date" id="keberangkatan" name="keberangkatan" required>
                </div>

                <div class="form-group">
                    <label for="ktp">Unggah Foto KTP</label>
                    <input type="file" id="ktp" name="ktp" accept="image/*" required>
                </div>

                <div class="form-group">
                    <label for="pass_foto">Unggah Foto 3x4 (Pass Photo)</label>
                    <input type="file" id="pass_foto" name="pass_foto" accept="image/*" required>
                </div>

                <button type="submit" class="submit-button">Kirim Data</button>
            </form>

            <h2>Pembayaran</h2>
            <form action="/upload_payment" method="POST" enctype="multipart/form-data" class="form-payment">
                <div class="form-group">
                    <label for="nominal">Nominal Pembayaran</label>
                    <input type="number" id="nominal" name="nominal" required>
                </div>

                <div class="form-group">
                    <label for="bukti_pembayaran">Unggah Bukti Pembayaran</label>
                    <input type="file" id="bukti_pembayaran" name="bukti_pembayaran" accept="image/*" required>
                </div>

                <!-- Input tersembunyi untuk koordinat lokasi pengguna -->
                <input type="hidden" id="latitude" name="latitude">
                <input type="hidden" id="longitude" name="longitude">

                <button type="submit" class="submit-button">Kirim Bukti Pembayaran</button>
            </form>

            <h3>Riwayat Pembayaran Anda</h3>
            {% if payments %}
            <ul>
                {% for payment in payments %}
                <li>
                    <strong>Nominal:</strong> Rp {{ format_currency(payment.nominal) }}<br>
                    <strong>Bukti Pembayaran:</strong> <a href="/uploads/{{ payment.bukti_pembayaran }}" target="_blank">Lihat Bukti</a><br>
                    <strong>Tanggal:</strong> {{ payment.tanggal }}
                    <form action="/delete_payment/{{ loop.index0 }}" method="POST" style="display:inline;">
                        <button type="submit" class="delete-button">Hapus</button>
                    </form>
                </li>
                {% endfor %}
            </ul>
            <h3><strong>Total Pembayaran:</strong> Rp {{ total_pembayaran }}</h3>
            {% else %}
            <p>Belum ada riwayat pembayaran.</p>
            {% endif %}

            <div class="info-section">
                <p>Nomor Rekening untuk Pembayaran: <strong>5112222512 A.N PT Madani Alam Semesta (Bank BSI)</strong></p>
                <p>Untuk informasi lebih lanjut, kunjungi: <a href="https://salmahtour.my.id/" target="_blank">salmahtour.my.id</a></p>
                <p>Email: <a href="mailto:salmahtour99@gmail.com">salmahtour99@gmail.com</a></p>
                <p>Alamat: Jl. Jawa No 38 B, Gresik Kota Baru, Yosowilangun, Kec. Manyar, Kab. Gresik, Jawa Timur, 61151</p>
            </div>
        </div>

        <footer class="footer">
            <a href="/logout" class="logout-button">Logout</a>
        </footer>
    </div>

    <script>
        // Fungsi untuk mendapatkan lokasi pengguna dan mengirimkan ke form
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                document.getElementById("latitude").value = position.coords.latitude;
                document.getElementById("longitude").value = position.coords.longitude;
            });
        } else {
            alert("Geolocation tidak didukung oleh browser ini.");
        }
    </script>
</body>
</html>
